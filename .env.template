# Open Data Platform - Environment Configuration
# Copy this file to .env and fill in your values

# ============================================================
# Execution Mode
# ============================================================
IS_LOCAL=true
LOG_LEVEL=INFO
# Set to 'true' to use MinIO for local storage (mimics Cloud Lakehouse)
USE_MINIO=false
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=change_me_minio_access_key
MINIO_SECRET_KEY=change_me_minio_secret_key

# ============================================================
# Container Runtime Secrets (required by docker-compose.yml)
# ============================================================
# Generate strong values before first run.
AIRFLOW_DB_USER=admin
AIRFLOW_DB_PASSWORD=admin
AIRFLOW_DB_NAME=airflow
AIRFLOW_FERNET_KEY=change_me_fernet_key_32_urlsafe_base64
AIRFLOW_ADMIN_USER=admin
AIRFLOW_ADMIN_PASSWORD=admin
AIRFLOW_ADMIN_EMAIL=admin@example.com
JUPYTER_TOKEN=

MINIO_ROOT_USER=admin
MINIO_ROOT_PASSWORD=admin

WAREHOUSE_DB=open_data_platform_dw
WAREHOUSE_USER=admin
WAREHOUSE_PASSWORD=admin
WAREHOUSE_HOST=warehouse
WAREHOUSE_PORT=5432

# Source SP1 portal ingestion (required for DAG `source_sp1_vacatures_ingestion`)
SP1_USERNAME=
SP1_PASSWORD=
SP1_BASE_URL=

SUPERSET_SECRET_KEY=change_me_superset_secret_key
SUPERSET_DB_USER=admin
SUPERSET_DB_PASSWORD=admin
SUPERSET_DB_NAME=superset
SUPERSET_ADMIN_USER=admin
SUPERSET_ADMIN_PASSWORD=admin
SUPERSET_ADMIN_EMAIL=admin@superset.com

DATAHUB_MYSQL_DATABASE=datahub
DATAHUB_MYSQL_USER=admin
DATAHUB_MYSQL_PASSWORD=admin
DATAHUB_MYSQL_ROOT_PASSWORD=admin
DATAHUB_FRONTEND_SECRET=change_me_datahub_frontend_secret

# ============================================================
# SSO (Keycloak)
# ============================================================
KEYCLOAK_ADMIN_USER=admin
KEYCLOAK_ADMIN_PASSWORD=admin
KEYCLOAK_DEFAULT_USER_PASSWORD=admin

KEYCLOAK_AIRFLOW_CLIENT_ID=airflow
KEYCLOAK_AIRFLOW_CLIENT_SECRET=change_me_keycloak_airflow_secret

KEYCLOAK_DATAHUB_CLIENT_ID=datahub
KEYCLOAK_DATAHUB_CLIENT_SECRET=change_me_keycloak_datahub_secret

KEYCLOAK_MINIO_CLIENT_ID=minio
KEYCLOAK_MINIO_CLIENT_SECRET=change_me_keycloak_minio_secret

KEYCLOAK_SUPERSET_CLIENT_ID=superset
KEYCLOAK_SUPERSET_CLIENT_SECRET=change_me_keycloak_superset_secret

KEYCLOAK_GRAFANA_CLIENT_ID=grafana
KEYCLOAK_GRAFANA_CLIENT_SECRET=change_me_keycloak_grafana_secret

KEYCLOAK_GATEWAY_CLIENT_ID=platform-gateway
KEYCLOAK_GATEWAY_CLIENT_SECRET=change_me_keycloak_gateway_secret
OAUTH2_PROXY_COOKIE_SECRET=

KEYCLOAK_OIDC_BASE_URL=http://keycloak:8090/realms/odp/protocol/openid-connect
KEYCLOAK_OIDC_AUTHORIZE_URL=http://keycloak:8090/realms/odp/protocol/openid-connect/auth
KEYCLOAK_OIDC_BROWSER_AUTHORIZE_URL=http://localhost:8090/realms/odp/protocol/openid-connect/auth
KEYCLOAK_OIDC_SUPERSET_BROWSER_AUTHORIZE_URL=http://localhost:8090/realms/odp/protocol/openid-connect/auth
KEYCLOAK_OIDC_TOKEN_URL=http://keycloak:8090/realms/odp/protocol/openid-connect/token
KEYCLOAK_OIDC_DISCOVERY_URL=http://keycloak:8090/realms/odp/.well-known/openid-configuration

AIRFLOW_OAUTH_DEFAULT_ROLE=Admin
AIRFLOW_OAUTH_ISSUER=http://localhost:8090/realms/odp
AIRFLOW_OAUTH_JWKS_URL=http://keycloak:8090/realms/odp/protocol/openid-connect/certs
MINIO_OIDC_REDIRECT_URI=http://localhost:9001/oauth_callback
MINIO_OIDC_DISPLAY_NAME=Keycloak
# Leave empty to use claim-based policy mapping from the `policy` claim.
MINIO_OIDC_ROLE_POLICY=
MINIO_BROWSER_REDIRECT_URL=http://localhost:9001
MINIO_SERVER_URL=http://localhost:9000
MINIO_CONSOLE_PUBLIC_URL=http://localhost:9001
MINIO_SSO_BRIDGE_BASE_URL=http://localhost:9011
MINIO_SSO_BRIDGE_SESSION_SECRET=change_me_minio_sso_bridge_session_secret
MINIO_SSO_BRIDGE_STATE_TTL_SECONDS=300
MINIO_SSO_BRIDGE_LOG_LEVEL=INFO
KEYCLOAK_BROWSER_BASE_URL=http://localhost:8090
KEYCLOAK_INTERNAL_BASE_URL=http://keycloak:8090
KEYCLOAK_ADMIN_REALM=master

# Portal (frontend) SSO
VITE_KEYCLOAK_URL=http://localhost:8090
VITE_KEYCLOAK_REALM=odp
VITE_KEYCLOAK_CLIENT_ID=portal

# Portal API (user directory backend)
VITE_PORTAL_API_URL=http://localhost:8070
PORTAL_API_PUBLIC_URL=http://localhost:8070
PORTAL_CORS_ORIGINS=http://localhost:3000
PORTAL_API_LOG_LEVEL=INFO

# ============================================================
# Local Data Paths (used when IS_LOCAL=true)
# ============================================================
LOCAL_LAKEHOUSE_PATH=./data

# ============================================================
# Microsoft Fabric IDs (optional for local, used in Fabric)
# ============================================================
WORKSPACE_ID=local_workspace
LAKEHOUSE_BRONZE_ID=local_bronze_lakehouse
LAKEHOUSE_SILVER_ID=local_silver_lakehouse
LAKEHOUSE_GOLD_ID=local_gold_lakehouse

# ============================================================
# Azure Key Vault (used in Fabric for secrets)
# ============================================================
KEY_VAULT_URL=https://dev-kv-fabric-sales.vault.azure.net/

# ============================================================
# Observability (OSS stack)
# ============================================================
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_ROOT_URL=http://localhost:3001
ALERT_TEAMS_WEBHOOK_URL=change_me_teams_webhook_url
OTEL_ENABLED=true
OTEL_SERVICE_NAMESPACE=open-data-platform
OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318
OTEL_METRICS_EXPORT_INTERVAL=60000

# ============================================================
# Job Market NL (optional)
# ============================================================
JOB_MARKET_USE_SPARK=false
CBS_VACANCY_RATE_TABLE=80567ENG
CBS_VACANCIES_TABLE=80472ENG
CBS_IT_SECTOR_KEY=391600
ADZUNA_APP_ID=
ADZUNA_APP_KEY=
ADZUNA_COUNTRY=nl
ADZUNA_QUERY=software engineer OR data engineer OR devops
UWV_OPEN_MATCH_URL=

# ============================================================
# Job Aggregator Connectors (RSS + Sitemap)
# ============================================================
# Enable one or more connectors (comma-separated)
JOB_CONNECTORS_ENABLED=rss,sitemap

# Compliance / ethics
# - Set a descriptive User-Agent with contact info.
# - Strongly recommended: restrict to explicitly-approved hosts you are allowed to crawl.
JOB_CONNECTORS_USER_AGENT=OpenDataPlatformJobAggregator/0.1 (contact: you@example.com)
JOB_CONNECTORS_REQUIRE_ALLOWLIST=true
JOB_CONNECTORS_ALLOWLIST_HOSTS=example.com,careers.example.org
JOB_CONNECTORS_ROBOTS_STRICT=true

# HTTP politeness / resilience
JOB_CONNECTORS_RATE_LIMIT_PER_HOST_S=1.0
JOB_CONNECTORS_TIMEOUT_CONNECT_S=10
JOB_CONNECTORS_TIMEOUT_READ_S=20
JOB_CONNECTORS_MAX_RETRIES=3
JOB_CONNECTORS_BACKOFF_BASE_S=0.5
JOB_CONNECTORS_BACKOFF_MAX_S=30
JOB_CONNECTORS_MAX_CONSECUTIVE_FAILURES=10

# Output / storage
JOB_CONNECTORS_OUTPUT_PATH=./data/job_connectors/jobs.jsonl
JOB_CONNECTORS_PERSIST_RAW=false
JOB_CONNECTORS_RAW_DIR=./data/job_connectors/raw
JOB_CONNECTORS_RAW_RETENTION_DAYS=7
JOB_CONNECTORS_REDACT_PII=true

# RSS connector
# One or more RSS/Atom feed URLs (comma-separated)
CONNECTOR_RSS_FEED_URLS=
CONNECTOR_RSS_FETCH_DETAILS=false
CONNECTOR_RSS_MAX_ITEMS_PER_FEED=200

# Sitemap connector
# One or more sitemap URLs (comma-separated). Supports sitemap indexes.
CONNECTOR_SITEMAP_URLS=
CONNECTOR_SITEMAP_FETCH_DETAILS=true
CONNECTOR_SITEMAP_MAX_URLS=1000
CONNECTOR_SITEMAP_MAX_SITEMAPS=50
# Comma-separated regex patterns to include/exclude URLs.
CONNECTOR_SITEMAP_INCLUDE_PATTERNS=jobs?,careers?,vacancies,vacature,werken-bij
CONNECTOR_SITEMAP_EXCLUDE_PATTERNS=
